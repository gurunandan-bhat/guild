{{ define "main" }}
    {{ $extLinkIcon := index site.Data.svgicons.icons "externalLink" | safeHTML }}


    <div class="container-fluid">
        <div style="height: 50px;"></div>
    </div>
    {{ $fullTitle := "" }}
    {{ $firstPage := index .Pages 0 }}
    {{ $fullTitle = $firstPage.Title }}
    {{ with $firstPage.Params.translatedTitle }}
        {{ $fullTitle = printf "%s (%s)" $fullTitle . }}
    {{ end }}
    <div>
        {{ $linkTitle := .LinkTitle }}
        {{ with partialCached "tmdb-meta.html" $linkTitle $linkTitle }}
            {{ $scoreImg := partial "fcg-rating.html" (dict "title" $linkTitle "size" "large") }}
            {{ partial "taxonomy/mreviews/metadata.html" (dict "meta" . "fullTitle" $fullTitle "scoreImg" $scoreImg) }}
        {{ else }}
            {{ warnf "Unable to get global resource %s" $linkTitle }}
        {{ end }}
    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-10 offset-lg-1">
                <h2 class="section-head">Guild Reviews</h2>
            </div>
            {{ $paginator := .Paginate .Pages 8 }}
            <div class="d-flex justify-content-center mb-3">
                {{ template "_internal/pagination.html" . }}
            </div>
            {{ range $paginator.Pages }}
                <div class="mb-3">
                    {{ if eq .Params.media "print" }}
                        <div class="row mb-1">
                            <div class="col-lg-4 offset-lg-1">
                                {{ $imgPath := printf "images/reviews/%s" .Params.img }}
                                {{ $img := resources.Get $imgPath }}
                                {{ with $img }}
                                    <img
                                        src="{{ .RelPermalink }}"
                                        class="img-fluid w-100 review-image mt-2" />
                                {{ end }}
                            </div>
                            <div class="col-lg-6">
                                <div
                                    class="border border-start-2 border-end-2 border-top-0 border-bottom-0">
                                    <div
                                        class="border border-3 border-top-0 border-start-0 border-end-0">
                                        <div class="px-4">
                                            <h2 class="mb-2">
                                                {{ .Params.subtitle }}
                                            </h2>
                                            <div class="pb-1">
                                                {{ partial "reviewer.html" (dict "reviewer" (index .Params.critics 0 ) "date" (.Date | time.Format ":date_long")) }}
                                            </div>
                                            <div class="small">
                                                {{ .Summary }}
                                            </div>
                                            <p class="small">
                                                <a
                                                    href="{{ .Params.source }}"
                                                    target="_blank">
                                                    {{ $extLinkIcon }} Continue
                                                    reading &hellip;</a
                                                >
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {{ else }}
                        <div class="row">
                            <div class="col-lg-6 offset-lg-3">
                                <h2 class="my-3">{{ .Params.subtitle }}</h2>
                                <div class="mb-4">
                                    {{ partial "reviewer.html" (dict "reviewer" (index .Params.critics 0 ) "date" (.Date | time.Format ":date_long")) }}
                                </div>
                                {{ .Summary }}
                            </div>
                        </div>
                    {{ end }}
                </div>
            {{ end }}
            <div class="d-flex justify-content-center">
                {{ template "_internal/pagination.html" . }}
            </div>
            {{ $reviews := partial "recent-film-list.html" (dict "maxCount" 4 "section" "reviews") }}
            <div class="container">
                <div class="row">
                    <h2 class="section-head">Latest Reviews</h2>
                </div>
                <div class="row">
                    {{ range $reviews }}
                        <div class="col">
                            {{ $scoreImg := partial "fcg-rating.html" (dict "title" .LinkTitle "size" "medium") }}
                            {{ partial "short-meta.html" (dict "context" . "type" "short" "scoreImg" $scoreImg) }}
                        </div>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
{{ end }}
